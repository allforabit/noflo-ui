<polymer-element name="noflo-library" attributes="editor search">
  <script>
    Polymer('noflo-library', {
      search: '',
      editor: null,
      buttons: function () {
        this.fire('button', {
          id: 'library',
          icon: 'plus',
          label: 'Library',
          search: 'show library'
        });
      },
      addNode: function (component) {
        var num = 60466176; // 36^5
        num = Math.floor(Math.random() * num);
        var id = component + '_' + num.toString(36);
        this.editor.$.graph.nodes.push({
          name: id,
          component: component,
          metadata: {
            label: component,
            x: 100,
            y: 100
          }
        });
      },
      searchChanged: function () {
        if (!this.search) {
          return;
        }
        Object.keys(this.editor.library).forEach(function (component) {
          if (this.search !== 'show library' && component.toLowerCase().indexOf(this.search.toLowerCase()) === -1) {
            return;
          }
          this.fire('result', {
            label: component,
            icon: this.editor.library[component].icon,
            description: this.editor.library[component].description,
            action: function () {
              this.addNode(component);
            }.bind(this)
          });
        }.bind(this));
      }
    });
  </script>
</polymer-element>
