<polymer-element name="noflo-node-inspector" attributes="node graph">
  <style>
    ul.ports li {
      display: block;
    }
    ul.ports li label span {
      float: left;
      clear: left;
      font-size: 8pt;
      padding-top: 8px;
      width: 100px;
      height: 27px;
      overflow: hidden;
    }
    ul.ports li label input {
      width: 113px;
      height: 19px;
      border: none;
      font-family: "SourceCodePro",Helvetica,Arial,sans-serif;
      padding: 8px;
      background-color: hsl(184, 50%, 11%);
      color: hsl(184, 40%, 89%);
    }
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none; 
      margin: 0; 
    }
    ul.ports li button {
      padding: 8px;
      height: 19px;
      width: 19px;
    }
    ul.ports li label button {
      background-color: hsl(184, 50%, 11%);
      color: hsl(184, 40%, 89%);
      display: block;
      padding: 8px;
      height: 19px;
      width: 19px;
    }
    ul.ports li span.route {
      /* TODO: route colors */
      background-color: white;
      float: none;
      display: inline-block;
      width: 125px;
      height: 1px;
      padding: 0;
    }
    ul.ports li span.route1  { background-color: hsl(  0, 100%, 60%); }
    ul.ports li span.route2  { background-color: hsl( 30, 100%, 60%); }
    ul.ports li span.route3  { background-color: hsl( 60, 100%, 60%); }
    ul.ports li span.route4  { background-color: hsl( 90, 100%, 60%); }
    ul.ports li span.route5  { background-color: hsl(120, 100%, 60%); }
    ul.ports li span.route6  { background-color: hsl(150, 100%, 60%); }
    ul.ports li span.route7  { background-color: hsl(180, 100%, 60%); }
    ul.ports li span.route8  { background-color: hsl(210, 100%, 60%); }
    ul.ports li span.route9  { background-color: hsl(240, 100%, 60%); }
    ul.ports li span.route10 { background-color: hsl(270, 100%, 60%); }
    ul.ports li span.route11 { background-color: hsl(300, 100%, 60%); }
    ul.ports li span.route12 { background-color: hsl(330, 100%, 60%); }

  </style>
  <template>
  <h1 on-keyup="{{ updateLabel }}" contenteditable>{{ node.label }}</h1>
    <h2>{{ node.component }}</h2>
    <ul class="ports">
      <template repeat="{{ port in inports }}">
        <li>
        <label><span>{{ port.name }}</span>
          <template if="{{ port.showInput }}">
            <template if="{{ port.type == 'bang' }}">
              <button name="{{ port.name }}" on-click="{{ sendBang }}"><i class="fa fa-bolt"></i></button>
            </template>
            <template if="{{ port.type == 'boolean' }}">
              <input type="checkbox" name="{{ port.name }}" checked="{{ port.value }}" on-change="{{ updateValue }}">
            </template>
            <template if="{{ port.type != 'bang' && port.type != 'boolean' }}">
              <input type="{{ port.type }}" name="{{ port.name }}" value="{{ port.value }}" on-blur="{{ updateValue }}">
            </template>
            </label>
            <template if="{{ port.type != 'bang' && port.value != undefined }}">
              <button data-port="{{ port.name }}" on-click="{{ removeValue }}"><i class="fa fa-trash-o"></i></button>
            </template>
          </template>
          <template if="{{ !port.showInput }}">
            <span class="route route{{ port.route }}"></span>
          </template>
        </li>
      </template>
    </ul>
  </template>
  <script>
    Polymer('noflo-node-inspector', {
      inports: [],
      enteredView: function () {
        this.updatePorts();
      },
      updateLabel: function (event, detail, sender) {
        this.node.label = sender.innerText;
      },
      updatePorts: function () {
        this.inports = [];
        this.node.getInports().forEach(function (port) {
          this.inports.push({
            name: port.name,
            type: port.type,
            value: port.getValue(),
            showInput: (!port.isConnected()),
            route: port.route
          });
        }.bind(this));
      },
      updateValue: function (event, detail, sender) {
        event.preventDefault();
        if (!sender.value) {
          return;
        }
        var value = sender.value;
        if (sender.type==="checkbox") {
          value = sender.checked;
        }
        var port = this.node.getInportByName(sender.getAttribute('name'));
        port.setValue(value);
      },
      removeValue: function (event, detail, sender) {
        event.preventDefault();
        var name = sender.getAttribute('data-port');
        var port = this.node.getInportByName(name);
        port.removeValue();
        this.inports.forEach(function (port) {
          if (port.name === name) {
            port.value = null;
          }
        });
      },
      sendBang: function (event, detail, sender) {
        event.preventDefault();
        var name = sender.getAttribute('name');
        var port = this.node.getInportByName(name);
        port.sendBang();
      }
    });
  </script>
</polymer-element>
